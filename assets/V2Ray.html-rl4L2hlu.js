import{_ as t,r as s,o as l,c as r,d as i,e as a}from"./app-Bmelea3n.js";const h={},d=a(`<h2 id="准备工作" tabindex="-1"><a class="header-anchor" href="#准备工作"><span>准备工作</span></a></h2><ol><li>一台境外<code>vps</code></li><li>一个域名,并解析一个<code>A</code>记录到<code>vps</code>的<code>ip</code></li></ol><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><h3 id="使用docker安装" tabindex="-1"><a class="header-anchor" href="#使用docker安装"><span>使用<code>docker</code>安装</span></a></h3><p>使用<a href="https://github.com/anerg2046/Caddy_V2ray" target="_blank" rel="noopener noreferrer">这个镜像</a>,命令行是:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 80:80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 443:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name=caddy_v2ray</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.v2ray:/etc/v2ray:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.caddy:/etc/caddy:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.certificates:/data/caddy/certificates:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\ </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DOMAIN=v2ray.cruldra.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">#这里换成你自己的域名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> EMAIL=cruldra@gmail.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">     \\ </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   # 这里换成你自己的邮箱,canndy去申请证书的时候会用到</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">anerg/v2ray:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),p=a(`<pre><code>这种方式会占用\`80\`和\`443\`端口,适合\`vps\`仅用作\`v2ray\`的情况
</code></pre><p>如果你的<code>vps</code>上还有其他<code>web</code>服务,则可以复用上面这个镜像自带的<a href="https://caddyserver.com/" target="_blank" rel="noopener noreferrer"><code>cadddy</code></a>服务器</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 先停止并删除上面的容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> caddy_v2ray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> caddy_v2ray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 然后把其它的网站文件映射到容器中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 80:80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 443:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --name=caddy_v2ray</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --restart=always</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.v2ray:/etc/v2ray:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.caddy:/etc/caddy:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/你的网站根目录:/var/www/网站名称</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/app/v2ray/.certificates:/data/caddy/certificates:rw</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\ </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DOMAIN=v2ray.cruldra.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">#这里换成你自己的域名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> EMAIL=cruldra@gmail.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">     \\ </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   # 这里换成你自己的邮箱,canndy去申请证书的时候会用到</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">anerg/v2ray:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再编辑<code>.caddy</code>目录下的<code>Caddyfile</code>文件,添加你的网站配置,比如:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">chat.cruldra.com</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  file_server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">		root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/www/你的网站的名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">	tls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cruldra@gmail.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">	reverse_proxy</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /aaa/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 172.17.0.1:3210</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">		header_up</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Forwarded-For</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {remote_host}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后再进入容器命令行,重启<code>caddy</code>服务即可:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> caddy_v2ray</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;cd /etc/caddy &amp;&amp; caddy reload&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>具体步骤参考<a href="https://codefuturesql.top/post/vps/" target="_blank" rel="noopener noreferrer">这篇文章</a></p><h2 id="核心概念" tabindex="-1"><a class="header-anchor" href="#核心概念"><span>核心概念</span></a></h2><ol><li><code>客户端</code> - 比如<a href="https://github.com/lantongxue/clash_for_windows_pkg/releases/tag/0.20.39" target="_blank" rel="noopener noreferrer"><code>clash</code></a>,使用<a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1103303693824096" target="_blank" rel="noopener noreferrer"><code>WebSocket</code></a>+<a href="https://www.cloudflare.com/zh-cn/learning/ssl/transport-layer-security-tls/" target="_blank" rel="noopener noreferrer"><code>tls</code></a>伪装成一个普通的<code>https</code>请求,然后发送给<code>nginx</code></li><li><code>nginx</code> - 把收到的用户请求用<code>websocket</code>请求转发给本机上的<code>v2ray</code>服务</li><li><a href="https://github.com/v2fly/v2ray-core" target="_blank" rel="noopener noreferrer"><strong>v2ray</strong></a> - <a href="https://www.v2ray.com/chapter_02/protocols/vmess.html" target="_blank" rel="noopener noreferrer"><code>VMess</code></a>协议的实现,用于流量转发</li></ol><p>下面这张图可以帮助你理解这几个组件的关系:</p><figure><img src="https://cdn.jsdelivr.net/gh/hhypygy/picx-images-hosting@master/v2ray_tls_websocket_nginx.9gwasm9udf.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="生成订阅链接" tabindex="-1"><a class="header-anchor" href="#生成订阅链接"><span>生成订阅链接</span></a></h2><p><code>v2ray</code>安装好以后还需要生成订阅链接给<code>clash</code>这类客户端使用</p><ol><li>运行<code>docker logs -f v2ray</code>命令可以看到<code>vmess</code>链接,将其复制下来</li></ol><figure><img src="https://cdn.jsdelivr.net/gh/hhypygy/picx-images-hosting@master/image.2kropbu8tq.webp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="2"><li>使用<a href="https://acl4ssr-sub.github.io/" target="_blank" rel="noopener noreferrer">ACL4SSR 在线订阅转换</a>生成<code>clash</code>订阅链接</li></ol>`,17);function k(c,o){const e=s("CommandBuilder"),n=s("VidStack");return l(),r("div",null,[d,i(e,{editors:[{label:"容器名称",placeholder:"docker容器的名称",field:"dockerContainerName",type:"text",defaultValue:"v2ray"},{label:"http端口",placeholder:"映射到caddy容器的80端口",field:"httpPort",type:"number",defaultValue:80},{label:"https端口",placeholder:"映射到caddy容器的443端口",field:"httpsPort",type:"number",defaultValue:443},{label:"域名",placeholder:"v2ray.xxx.com",field:"domain",type:"text"},{label:"邮箱",placeholder:"caddy去申请证书的时候会用到",field:"email",type:"text",defaultValue:"cruldra@gmail.com"}],cmdTemplate:`docker run -d  -p {httpPort}:80   -p {httpsPort}:443 --name={dockerContainerName} --restart=always  \\
-v /app/v2ray/.v2ray:/etc/v2ray:rw   \\
-v /app/v2ray/.caddy:/etc/caddy:rw   \\
-v /app/v2ray/.certificates:/data/caddy/certificates:rw  \\
-e DOMAIN={domain}  \\
-e EMAIL={email}     \\
anerg/v2ray:latest`}),p,i(n,{src:"https://cruldra-pic.oss-cn-hangzhou.aliyuncs.com/bandicam 2024-03-29 21-19-35-915.mp4"})])}const y=t(h,[["render",k],["__file","V2Ray.html.vue"]]),v=JSON.parse('{"path":"/Tools/Network/V2Ray.html","title":"v2Ray","lang":"zh-CN","frontmatter":{"title":"v2Ray","comment":false,"editLink":false,"prev":false,"next":false,"description":"准备工作 一台境外vps 一个域名,并解析一个A记录到vps的ip 安装 使用docker安装 使用这个镜像,命令行是:","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/Tools/Network/V2Ray.html"}],["meta",{"property":"og:site_name","content":"一星的臭弟弟"}],["meta",{"property":"og:title","content":"v2Ray"}],["meta",{"property":"og:description","content":"准备工作 一台境外vps 一个域名,并解析一个A记录到vps的ip 安装 使用docker安装 使用这个镜像,命令行是:"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/hhypygy/picx-images-hosting@master/v2ray_tls_websocket_nginx.9gwasm9udf.webp"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-03T23:01:39.000Z"}],["meta",{"property":"article:author","content":"Cruldra"}],["meta",{"property":"article:modified_time","content":"2024-07-03T23:01:39.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"v2Ray\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/hhypygy/picx-images-hosting@master/v2ray_tls_websocket_nginx.9gwasm9udf.webp\\",\\"https://cdn.jsdelivr.net/gh/hhypygy/picx-images-hosting@master/image.2kropbu8tq.webp\\"],\\"dateModified\\":\\"2024-07-03T23:01:39.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Cruldra\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"准备工作","slug":"准备工作","link":"#准备工作","children":[]},{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[{"level":3,"title":"使用docker安装","slug":"使用docker安装","link":"#使用docker安装","children":[]}]},{"level":2,"title":"核心概念","slug":"核心概念","link":"#核心概念","children":[]},{"level":2,"title":"生成订阅链接","slug":"生成订阅链接","link":"#生成订阅链接","children":[]}],"git":{"createdTime":1720047699000,"updatedTime":1720047699000,"contributors":[{"name":"cruldra","email":"cruldra@gmail.com","commits":1}]},"readingTime":{"minutes":2.34,"words":702},"filePathRelative":"Tools/Network/V2Ray.md","localizedDate":"2024年7月3日","autoDesc":true}');export{y as comp,v as data};
