---
title: Redis持久化
comment: false
editLink: false
prev: false
next: false
order: 1
---

## 简介

由于`Redis`是内存数据库,所以我们定期将数据保存到磁盘来避免数据丢失导致发生灾难性的后果是非常有必要的

`Redis`支持两种主要的数据持久化机制:[AOF(Append Only File)](#aof-append-only-file)和[RDB(Redis Database)](#rdb-redis-database)

## RDB(Redis Database)

`RDB`是`Redis`默认的持久化方式,`Redis`会将内存中的数据以快照的形式写入到磁盘中

### 优点

* **紧凑的数据格式** - `RDB`文件经过高度压缩和优化,减少了磁盘空间的使用.
* **恢复速度快** - `RDB`文件中包含完整的数据快照,所以恢复速度比`AOF`快

### 缺点

* **数据丢失** - `RDB`快照是定期拍摄的,这意味着在系统崩溃的情况下,可能会丢失尚未包含在最新快照中的数据
* **不适合大规模数据集** - `Redis`进程会`fork`一个子进程来创建或恢复快照,数据集越大,对性能的影响越大


## AOF(Append Only File)

`AOF`这种方式会将每次写入`Redis`的命令追加到`AOF`文件中,当`Redis`重启时,会重新执行`AOF`文件中的命令来恢复数据

### 优点

* **数据不丢失** - `AOF`文件中包含了完整的`Redis`操作日志,所以即使系统崩溃,也不会丢失数据
* **可读性强** - `AOF`文件以纯文本格式存储命令，使其易于检查和理解
* **适合大规模数据集** - `AOF`文件中的命令是追加的,所以不需要`fork`子进程来创建或恢复快照,所以对性能的影响较小

### 缺点

* **文件体积大** - `AOF`文件中包含了完整的`Redis`操作日志,所以文件体积会比较大
* **恢复速度较慢** - 因为`Redis`要把`AOF`文件中的命令重新执行一遍,所以恢复速度比`RDB`慢


## 混合持久化

`Redis`允许同时使用`RDB`和`AOF`两种持久化方式,这种方式下,`Redis`会优先使用`AOF`文件来恢复数据,如果`AOF`文件不存在,则使用`RDB`文件来恢复数据

## 应用场景

如果需要**最大化性能**并且**可以接受最近几分钟内的数据丢失**,那么可以使用`RDB`持久化方式

如果需要**最大化数据安全性**并且**可以接受稍微降低一些性能**,那么可以使用`AOF`持久化方式


## 参考

* [Redis持久化机制 RDB、AOF、混合持久化详解！如何选择？ - JavaGuide - 博客园](https://www.cnblogs.com/javaguide/p/redis-persistence.html)
